import{f as w,j as e,e as A,u as U,r as o,O as I,U as q,d as O,b as L,a as z,S as B,c as P}from"./index-OLy-s8nC.js";import{O as j}from"./Card-ffu4qo4M.js";import{O as $,a as V}from"./Grid-BuOktf-L.js";import{O as _}from"./Heading-CVxeAvcx.js";import T from"./Error404-LpiPXdZi.js";import{b as C,O as M,a as E}from"./FormMessage-C9hwLOhE.js";import{O as D}from"./Alert-DL7e4AUV.js";import{C as G}from"./construction-CIhSy-m2.js";import"./shield-alert-pw1ISJiI.js";const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],W=w("circle-user",H);const Y=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],Z=w("cog",Y);const J=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],K=w("image",J);function Q({variant:n="circles",fullview:i=!1}){return e.jsx("div",{className:`oyk-loading ${i?"oyk-loading-fullview":""}`,children:e.jsx("div",{className:`oyk-loading-spinner oyk-${n}`})})}function X(){const{currentUser:n,setUser:i}=A(),{t:a}=U(),k=o.useRef(null),d=o.useRef(null),f=o.useRef(null),h=o.useRef(null),b=o.useRef(null),[m,N]=o.useState(!1),[r,p]=o.useState(null),[t,v]=o.useState({avatar:n.avatar||null,cover:n.cover||null,name:n.name||"",slug:n.slug||"",abbr:n.abbr||""}),S=l=>{const{name:s,value:c}=l.target;v(g=>({...g,[s]:c})),r?.fields?.[s]&&p(g=>({...g,fields:{...g.fields,[s]:""}}))},R=l=>{p(s=>({...s,[l]:null})),l==="avatar"&&k.current?.click(),l==="cover"&&d.current?.click()},F=l=>{const s=l.target.files?.[0];if(!s)return;if(s.size>2*1024*1024){p({avatar:a("Avatar image must be smaller than 2MB")});return}const c=URL.createObjectURL(s);v(g=>({...g,avatar:c,avatarFile:s}))},y=l=>{const s=l.target.files?.[0];if(!s)return;if(s.size>2*1024*1024){p({cover:a("Cover image must be smaller than 2MB")});return}const c=URL.createObjectURL(s);v(g=>({...g,cover:c,coverFile:s}))},u=async l=>{v({avatar:n.avatar||null,cover:n.cover||null,name:n.name||"",slug:n.slug||"",abbr:n.abbr||""}),f.current.value=n.name||"",h.current.value=n.slug||"",b.current.value=n.abbr||""},x=async l=>{N(!0),p(null);try{const s=new FormData;s.append("name",t.name),t.avatarFile&&s.append("avatar",t.avatarFile),t.coverFile&&s.append("cover",t.coverFile);const c=await L.post("/auth/me/edit/",s);if(c.success&&c.user)i(c.user),v(g=>({...g,name:c.user.name,slug:c.user.slug,abbr:c.user.abbr})),f.current.value=c.user.name,h.current.value=c.user.slug,b.current.value=c.user.abbr;else throw new Error}catch(s){p(s.error||a("An error occurred"))}finally{N(!1)}};return o.useEffect(()=>()=>{t.avatar?.startsWith("blob:")&&URL.revokeObjectURL(t.avatar),t.cover?.startsWith("blob:")&&URL.revokeObjectURL(t.cover)},[t.avatar,t.cover]),e.jsxs("section",{className:"oyk-settings-profile",children:[e.jsxs("article",{className:"oyk-settings-profile-visual",children:[e.jsx("div",{className:"oyk-settings-profile-visual-preview",children:e.jsxs(j,{nop:!0,fh:!0,alignTop:!0,children:[e.jsx(I,{avatarSize:80,avatarBorderSize:8,avatarTop:48,avatarSrc:t.avatar,coverSrc:t.cover,height:150}),(r?.avatar||r?.cover)&&e.jsx(C,{hasError:r?.avatar||r?.cover,style:{margin:"0 16px 16px"}})]})}),e.jsx("div",{className:"oyk-settings-profile-visual-avatar",children:e.jsxs(j,{fh:!0,clickable:!0,onClick:()=>R("avatar"),children:[e.jsx(q,{size:24,color:"var(--oyk-c-primary)"}),e.jsx("p",{className:"oyk-settings-profile-visual-avatar-title",children:a("Change Avatar")}),e.jsx("small",{className:"oyk-settings-profile-visual-avatar-max",children:a("200x200px (max 2MB)")}),e.jsx("input",{ref:k,name:"avatar",type:"file",accept:"image/png, image/jpeg, image/webp",hidden:!0,onChange:F})]})}),e.jsx("div",{className:"oyk-settings-profile-visual-cover",children:e.jsxs(j,{fh:!0,clickable:!0,onClick:()=>R("cover"),children:[e.jsx(K,{size:24,color:"var(--oyk-c-primary)"}),e.jsx("p",{className:"oyk-settings-profile-visual-cover-title",children:a("Change Cover")}),e.jsx("small",{className:"oyk-settings-profile-visual-cover-max",children:a("1136x256px (max 2MB)")}),e.jsx("input",{ref:d,name:"cover",type:"file",accept:"image/png, image/jpeg, image/webp",hidden:!0,onChange:y})]})})]}),e.jsx(j,{children:e.jsxs(M,{className:"oyk-settings-form",isLoading:m,onSubmit:x,children:[e.jsx("h2",{className:"oyk-settings-form-title",children:a("Your Profile")}),e.jsx(E,{ref:f,label:a("Public Name"),name:"name",defaultValue:t.name,onChange:S,hasError:r?.fields?.name,required:!0}),r?.name&&e.jsx(C,{hasError:r?.name}),e.jsx(E,{ref:h,label:a("Slug"),name:"slug",defaultValue:t.slug,onChange:S,hasError:r?.fields?.slug,required:!0,disabled:!0}),r?.slug&&e.jsx(C,{hasError:r?.slug}),e.jsx(E,{ref:b,label:a("Abbreviation"),name:"abbr",defaultValue:t.abbr,onChange:S,hasError:r?.fields?.abbr,required:!0,disabled:!0}),r?.abbr&&e.jsx(C,{hasError:r?.abbr}),e.jsxs("div",{className:"oyk-form-actions",children:[e.jsx(O,{type:"submit",color:"primary",disabled:m,children:a(m?"Saving...":"Save")}),e.jsx(O,{type:"reset",disabled:m,outline:!0,action:u,children:a("Cancel")})]})]})})]})}function ee(){const{currentUser:n}=A(),{t:i}=U(),a=o.useRef(null),k=o.useRef(null),[d,f]=o.useState(!0),[h,b]=o.useState(!1),[m,N]=o.useState(null),[r,p]=o.useState({username:"",email:""}),[t,v]=o.useState(r),S=async y=>{f(!0),N(null);try{const u=await L.get("/auth/me/account/",{signal:y});if(!u.success||!u.account)throw Error();p(x=>({...x,username:u.account.username,email:u.account.email})),v(x=>({...x,username:u.account.username,email:u.account.email}))}catch(u){if(u?.name==="AbortError")return;N({form:i("An error occurred")})}finally{y.aborted||f(!1)}},R=y=>{const{name:u,value:x}=y.target;v(l=>({...l,[u]:x})),m?.fields?.[u]&&N(l=>({...l,fields:{...l.fields,[u]:""}}))},F=async()=>{v({username:r.username,email:r.email}),a.current.value=r.username||"",k.current.value=r.email||""};return o.useEffect(()=>{const y=new AbortController;return S(y.signal),()=>{y.abort()}},[]),e.jsx("section",{className:"oyk-settings-profile",children:m?.form?e.jsx(j,{children:e.jsx(D,{title:i("An error occurred"),message:i("Unable to access account data, check your internet connection or try again later"),variant:"danger"})}):e.jsx(j,{children:d?e.jsx(Q,{}):e.jsxs(M,{className:"oyk-settings-form",isLoading:d,children:[e.jsx("h2",{className:"oyk-settings-form-title",children:i("Your Account")}),e.jsx(E,{ref:a,label:i("Username"),name:"username",defaultValue:t.username,onChange:R,hasError:m?.fields?.username,required:!0}),m?.username&&e.jsx(C,{hasError:m?.username}),e.jsx(E,{ref:k,label:i("Email"),name:"email",defaultValue:t.email,onChange:R,hasError:m?.fields?.email,required:!0}),m?.email&&e.jsx(C,{hasError:m?.email}),e.jsxs("div",{className:"oyk-form-actions",children:[e.jsx(O,{type:"submit",color:"primary",disabled:d||h,children:i(h?"Saving...":"Save")}),e.jsx(O,{type:"reset",disabled:d||h,outline:!0,action:F,children:i("Cancel")})]})]})})})}function ue(){const{isAuth:n}=A(),{params:i}=z(),{t:a}=U(),k=[{title:a("Profile"),description:a("Change your avatar and cover images, your name, and more"),Icon:W,links:[{name:a("General"),routeName:"settings-profile"}]},{title:a("Account"),description:a("Change settings, configure notifications, and more"),Icon:Z,links:[{name:a("General"),routeName:"settings-account"},{name:a("Change Password"),routeName:"settings-account-password"},{name:a("Privacy"),routeName:"settings-account-privacy"}]},{title:a("Friends"),description:a("Manage friends and accept invites"),Icon:B,links:[{name:a("Manage Friends"),routeName:"settings-friends"},{name:a("Invites"),routeName:"settings-friends-invites"}]}];return n?e.jsxs("section",{className:"oyk-page oyk-settings",children:[e.jsx(_,{title:a("Settings")}),e.jsx($,{children:e.jsxs("div",{className:"oyk-settings-grid",children:[e.jsx("aside",{className:"oyk-settings-grid-nav",children:e.jsx("nav",{className:"oyk-settings-nav",children:e.jsx("ul",{children:k.map((d,f)=>e.jsxs("li",{className:`oyk-settings-nav-item ${f<=0?"oyk-first":""}`,children:[e.jsxs("header",{className:"oyk-settings-nav-header",children:[e.jsx("span",{className:"oyk-settings-nav-header-icon",children:e.jsx(d.Icon,{size:24,color:"var(--oyk-c-primary)"})}),e.jsxs("span",{className:"oyk-settings-nav-header-title",children:[e.jsx("span",{className:"oyk-settings-nav-header-title-name",children:d.title}),e.jsx("small",{className:"oyk-settings-nav-header-title-desc",children:d.description})]})]}),e.jsx("ul",{className:"oyk-settings-nav-menu",children:d.links.map((h,b)=>e.jsx("li",{className:"oyk-settings-nav-menu-item",children:e.jsx(P,{routeName:h.routeName,className:`oyk-settings-nav-menu-item-link ${`settings-${i?.section}`===h.routeName?"oyk-active":""}`,children:h.name})},b))})]},f))})})}),e.jsx("div",{className:"oyk-settings-grid-main",children:i?.section==="profile"?e.jsx(X,{}):i?.section==="account"?e.jsx(ee,{}):e.jsx(j,{children:e.jsx(V,{ghost:!0,variant:"warning",title:a("Under Construction"),message:a("These settings are currently in development and should be available soon"),icon:G})})})]})})]}):e.jsx(T,{})}export{ue as default};
